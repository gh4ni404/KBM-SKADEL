<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap.min.css" />
  <link rel="stylesheet" type="text/css"
    href="https://cdn.datatables.net/fixedheader/3.2.0/css/fixedHeader.bootstrap.min.css" />
  <link rel="stylesheet" type="text/css"
    href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.bootstrap.min.css" />
  <title>Daftar Mahasiswa</title>
</head>
<body">
  <div class="container">
    <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <h3 class="text-center mb-4">LAPORAN KBM HARIAN SMKN 8 BONE</h3>
        <h4 class="text-center mb-4" id="date"></h4>
        <h4 class="text-center mb-4" id="packageName"></h4>
        <br>
        <br>
        <br>
        <br>
        <table id="example" class="table table-striped table-bordered text-center align-middle mt-2 mb-2"
          style="width: 100%"></table>
        <br />
        <br />
        <p id="passingGrade"></p>
      </div>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.11.3/js/dataTables.bootstrap.min.js"></script>
  <script src="https://cdn.datatables.net/fixedheader/3.2.0/js/dataTables.fixedHeader.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.2.9/js/responsive.bootstrap.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <!-- <script type="text/javascript" src="data.json"></script> -->
  <script type="text/javascript">
    $(document).ready(function () {
      const url = "https://script.google.com/macros/s/AKfycbwxxDPptmg0b4BlIJJ-pie4POoeMIJjQGFEsHj7oAHHTU3YEEK9c2CCQb1n2D4UxB5YOg/exec";

      function fetchData() {
        fetch(url)
          .then(response => response.json())
          .then(data => {
            const rawDate = new Date(data.tanggal);
            const options = {
              weekday: 'long',
              day: '2-digit',
              month: 'long',
              year: 'numeric',
            };
            const formattedDate = rawDate.toLocaleDateString('id-ID', options);
            document.getElementById("date").textContent = `${formattedDate}`;

            if ($.fn.DataTable.isDataTable("#example")) {
              $("#example").DataTable().destroy();
            }

            $("#example").empty();

            $("#example").DataTable({
              ajax: url,
              columns: [
                {
                  title: "NO",
                  data: "1",
                },
                {
                  title: "KELAS",
                  data: "2",
                },

                {
                  title: "NAMA GURU MAPEL",
                  data: "3",
                },
                {
                  title: "MATA PELAJARAN",
                  data: "4",
                  render: function (data, type, row) {
                    if (data === "?" || !data) {
                      return "Tidak Ada Mata Pelajaran";
                    }
                    return data;
                  },
                },
                {
                  title: "MULAI JAM KE",
                  data: "5",
                  render: function (data, type, row) {
                    if (data === "?" || !data) {
                      return "Tidak Ada Jam";
                    }
                    return data;
                  },
                },
                {
                  title: "JUMLAH JAM",
                  data: "6",
                  render: function (data, type, row) {
                    if (data === "?" || !data) {
                      return "Tidak Ada Jam";
                    }
                    return data;
                  },
                },
                {
                  title: "NAMA WALI KELAS",
                  data: "7",
                  render: function (data, type, row) {
                    if (data === "?" || !data) {
                      return "Tidak Ada Nama Wali Kelas";
                    }
                    return data
                  }
                },
                {
                  title: "HADIR",
                  data: "8",
                },
                {
                  title: "SAKIT",
                  data: "9",
                },
                {
                  title: "IZIN",
                  data: "10",
                },
                {
                  title: "ALPA",
                  data: "11",
                },
                {
                  title: "KONDISI KELAS",
                  data: "12",
                },
                {
                  title: "DOKUMENTASI 1",
                  data: "13",
                  render: function (data, type, row) {
                    if (data === "?" || !data) {
                      return "Tidak Ada Dokumentasi";
                    }
                    return data
                      ? `<a href="${data}" target="_blank">Lihat Dokumentasi</a>`
                      : "Tidak Ada Dokumentasi";
                  },
                },
                {
                  title: "DOKUMENTASI 2",
                  data: "14",
                  render: function (data, type, row) {
                    if (data === "?" || !data) {
                      return "Tidak Ada Dokumentasi";
                    }
                    return data
                      ? `<a href="${data}" target="_blank">Lihat Dokumentasi</a>`
                      : "Tidak Ada Dokumentasi";
                  },
                },
                {
                  title: "DOKUMENTASI 3",
                  data: "15",
                  render: function (data, type, row) {
                    if (data === "?" || !data) {
                      return "Tidak Ada Dokumentasi";
                    }
                    return data
                      ? `<a href="${data}" target="_blank">Lihat Dokumentasi</a>`
                      : "Tidak Ada Dokumentasi";
                  },
                },
                {
                  title: "DOKUMENTASI 4",
                  data: "16",
                  render: function (data, type, row) {
                    if (data === "?" || !data) {
                      return "Tidak Ada Dokumentasi";
                    }
                    return data
                      ? `<a href="${data}" target="_blank">Lihat Dokumentasi</a>`
                      : "Tidak Ada Dokumentasi";
                  },
                },
                {
                  title: "PIKET PENGGANTI",
                  data: "17",
                }

              ],
              rowId: "KELAS",
              liveAjax: true,
            });
          }).catch(error => {
            console.error("Ada yang salah nih BOSKUU:", error);
            swal("Error", "Terjadi kesalahan saat mengambil data", "error");
          });
      }
      fetchData();

      setInterval(fetchData, 60000);
    });
  </script>
  </body>

</html>