<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/dataTables.bootstrap.min.css" />
  <link rel="stylesheet" type="text/css"
    href="https://cdn.datatables.net/fixedheader/3.2.0/css/fixedHeader.bootstrap.min.css" />
  <link rel="stylesheet" type="text/css"
    href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.bootstrap.min.css" />
  <title>Daftar Mahasiswa</title>
</head>

<body>
  <div class="container">
    <div class="row">
      <div class="col-lg col-md col-sm col-xs">
        <h3 class="text-center mb-4">LAPORAN KBM HARIAN SMKN 8 BONE</h3>
        <div class="form-group">
          <label for="dayFilter">Pilih Hari :</label>
          <select name="" id="dayFilter" class="form-control">
            <option value="">Semua Hari</option>
            <option value="SENIN">Senin</option>
            <option value="SELASA">Selasa</option>
            <option value="RABU">Rabu</option>
            <option value="KAMIS">Kamis</option>
            <option value="JUMAT">Jumat</option>
            <option value="SABTU">Sabtu</option>
            <option value="MINGGU">Minggu</option>
          </select>
        </div>
        <h4 class="text-center mb-4" id="date"></h4>
        <h4 class="text-center mb-4" id="packageName"></h4>
        <br>
        <br>
        <br>
        <br>
        <table id="example" class="table table-striped table-bordered text-center align-middle mt-2 mb-2"
          style="width: 100%"></table>
        <br />
        <br />
        <p id="passingGrade"></p>
      </div>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.11.3/js/dataTables.bootstrap.min.js"></script>
  <script src="https://cdn.datatables.net/fixedheader/3.2.0/js/dataTables.fixedHeader.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.2.9/js/responsive.bootstrap.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <!-- <script type="text/javascript" src="data.json"></script> -->
  <script type="text/javascript">
    $(document).ready(function () {
      const baseUrl = "https://script.google.com/macros/s/AKfycbwxxDPptmg0b4BlIJJ-pie4POoeMIJjQGFEsHj7oAHHTU3YEEK9c2CCQb1n2D4UxB5YOg/exec";

      function fetchData(day = "") {
        let url = baseUrl;
        if (day) {
          url += `?day=${day}`;
        }

        fetch(url)
          .then(response => response.json())
          .then(data => {
            const rawDate = new Date(data.tanggal);
            const options = {
              weekday: 'long',
              day: '2-digit',
              month: 'long',
              year: 'numeric',
            };
            const formattedDate = rawDate.toLocaleDateString('id-ID', options);
            document.getElementById("date").textContent = `${formattedDate}`;

            if (!$.fn.DataTable.isDataTable("#example")) {
              // Filter data berdasarkan hari
              let table = $("#example").DataTable({
                ajax: url,
                lengthMenu: [[-1, 10, 25, 50], ["All", 10, 25, 50]], // Tambahkan opsi "All" dengan nilai -1
                pageLength: -1, // Tampilkan semua data secara default
                columns: [
                  {
                    title: "NO",
                    data: "1",
                  },
                  {
                    title: "KELAS",
                    data: "2",
                  },
                  {
                    title: "NAMA GURU MAPEL",
                    data: "3",
                  },
                  {
                    title: "MATA PELAJARAN",
                    data: "4",

                  },
                  {
                    title: "MULAI JAM KE",
                    data: "5",

                  },
                  {
                    title: "JUMLAH JAM",
                    data: "6",

                  },
                  {
                    title: "NAMA WALI KELAS",
                    data: "7",

                  },
                  {
                    title: "HADIR",
                    data: "8",
                  },
                  {
                    title: "SAKIT",
                    data: "9",
                  },
                  {
                    title: "IZIN",
                    data: "10",
                  },
                  {
                    title: "ALPA",
                    data: "11",
                  },
                  {
                    title: "KONDISI KELAS",
                    data: "12",
                  },
                  {
                    title: "DOKUMENTASI 1",
                    data: "13",
                    render: function (data, type, row) {
                      if (data === "?" || !data) {
                        return "?";
                      }
                      return `<a href="${data}" target="_blank">Lihat Dokumentasi</a>`;
                    },
                  },
                  {
                    title: "DOKUMENTASI 2",
                    data: "14",
                    render: function (data, type, row) {
                      if (data === "?" || !data) {
                        return "?";
                      }
                      return `<a href="${data}" target="_blank">Lihat Dokumentasi</a>`;
                    },
                  },
                  {
                    title: "DOKUMENTASI 3",
                    data: "15",
                    render: function (data, type, row) {
                      if (data === "?" || !data) {
                        return "?";
                      }
                      return `<a href="${data}" target="_blank">Lihat Dokumentasi</a>`;
                    },
                  },
                  {
                    title: "DOKUMENTASI 4",
                    data: "16",
                    render: function (data, type, row) {
                      if (data === "?" || !data) {
                        return "?";
                      }
                      return `<a href="${data}" target="_blank">Lihat Dokumentasi</a>`;
                    },
                  },
                  {
                    title: "PIKET PENGGANTI",
                    data: "17",
                  }

                ],
                rowId: "KELAS",
                liveAjax: true,
              });
            } else {
              $("#example").DataTable().ajax.reload(null, false);
            }
          }).catch(error => {
            console.error("Ada yang salah nih BOSKUU:", error);
            swal("Error", "Terjadi kesalahan saat mengambil data", "error");
          });
      }
      fetchData();

      $("#dayFilter").change(function () {
        const selectedDay = $(this).val();
        fetchData(selectedDay);
      });

      setInterval(() => {
        fetchData($("#dayFilter").val());
      }, 60000);
    });
  </script>
</body>

</html>